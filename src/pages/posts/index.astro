---
import MainLayout from '../../layouts/MainLayout.astro';
import PostsList from '../../components/PostsList.astro';

// Get all posts and sort by date
const postModules = import.meta.glob('../posts/*.{md,mdx}');
const posts = await Promise.all(Object.values(postModules).map(fn => fn())) as any[];
const sortedPosts = posts
  .filter((post: any) => !post.frontmatter.draft)
  .sort((a: any, b: any) => 
    new Date(b.frontmatter.pubDate).getTime() - 
    new Date(a.frontmatter.pubDate).getTime()
  )
  .map((post: any) => ({
    title: post.frontmatter.title,
    url: post.url,
    description: post.frontmatter.description,
    pubDate: new Date(post.frontmatter.pubDate),
    draft: post.frontmatter.draft,
    tags: post.frontmatter.tags || [],
    readingTime: post.frontmatter.readingTime
  }));
---

<MainLayout title="Posts | holmdahl.io" description="Articles and thoughts">
  <div class="container mx-auto py-4">
    <h1 class="text-4xl font-bold">Posts</h1>
  </div>

  <div class="container mx-auto">
    <PostsList posts={sortedPosts} />
  </div>
</MainLayout> 